[TOC]


## 设备实时数据接口

**简要描述：** 

- 获取设备实时数据

**请求URL：** 
- ` api-shc.megahealth.cn/1.1/functions/getDeviceRealTimeData `

**请求方式：**

- GET

**请求参数：** 

| 参数名        | 必选 | 类型   | 说明           |
| :------------ | :--- | :----- | -------------- |
| sn            | 是   | string | 15位设备序列号 |
| institutionId | 是   | string | 24位机构号     |

**Header属性**

| KEY          | VALUE                             |
| ------------ | --------------------------------- |
| Content-Type | application/json                  |
| X-LC-Id      | F9tyT5VsLXLCAqxKvTHqzmvP-gzGzoHsz |
| X-LC-Key     | 17eIyz42rRL1YubtKE5MgLHm          |
| X-LC-Prod    | 0                                 |

 **返回示例**

``` json
{
    "result": {
        "height": 2,
        "weight": 14,
        "workStatus": 1,
        "monitorStatus": 0,
        "inBed": false,
        "breathRate": 0,
        "heartRate": -1,
        "bloodOxygen": -1,
        "battery": 100,
        "ringsn": "P11G22304000019",
        "swVersion": "5.0.12048",
        "monitor": 0,
        "powerStatus": 2,
        "connectStatus": 2,
        "tempetature": 0,
        "bootTime": 1720049751915,
        "wifiRssi": -127,
        "mobileRssi": 0,
        "networkType": 9,
        "frameArea": 2,
        "outBedAlarm": 2,
        "period": "23:45-06:45",
        "versionNO": "2.4.12377",
        "EC6Version": "1.0.12487"
        "updatedAt": 1720075573578
    }
}
```

 **返回参数说明** 

| 参数名          | 类型    | 说明                                                         |
| :-------------- | :------ | ------------------------------------------------------------ |
| workStatus      | number  | 睡眠仪工作状态，（0：未工作，1：工作中，2：未工作）          |
| monitorStatus   | number  | 睡眠仪监测状态：（0：未监测,1：监测中）                      |
| inBed           | boolean | 是否离床，（true：在床，false：离床）                        |
| breathRate      | number  | 呼吸率                                                       |
| heartRate       | number  | 心率                                                         |
| bloodOxygen     | number  | 血氧饱和度                                                   |
| height          | number  | 用户身高，（cm）                                             |
| weight          | number  | 用户体重，（kg）                                             |
| period          | string  | 设定监测时段， （开始时间-结束时间）                         |
| frameArea       | number  | 设定监测距离，m                                              |
| outBedAlarm     | number  | 设定离床告警时间                                             |
| simSerialNumber | number  | sim卡号                                                      |
| tempetature     | number  | 温度，3位小数                                                |
| bootTime        | number  | 设备启动时间，用以矫正温度值                                 |
| wifiRssi        | number  | wifi信号                                                     |
| mobileRssi      | number  | 移动信号                                                     |
| networkType     | number  | 网络类型（0：移动信号，1：wifi信号）                         |
| updatedAt       | number  | 设备更新时间                                                 |
| versionNO       | string  | 监护仪固件版本号                                             |
| battery         | number  | 指环电量                                                     |
| ringsn          | string  | 指环sn                                                       |
| swVersion       | string  | 指环固件版本                                                 |
| connectStatus   | number  | 指环连接状态，0：未连接  1连接中   2：已连接                 |
| monitor         | number  | 指环监测状态：（0：未监测,1：监测中）                        |
| powerStatus     | number  | 0: 正常工作；1: 正在充电；2: 充满，可工作；3: 低电，设备只保留蓝牙，其他模块关闭 |
| EC6Version      | string  | EC6版本号(只有M11B开头的设备推送)                            |

**备注** 

- 温度矫正方法：bootTime为设备启动时间，设diff为设备已启动分钟数

  - ```javascript
    if (diff <= 30) {
        temperature = temperature - diff * 0.2;
    } else {
        temperature = temperature - 6;
    }
    ```

- 监测状态及判定：

  - 设备未连接：workStatus == '0' || workStatus == '2'
  - 用户离床：workStatus == '1'  &&  inBed==false 
  - 用户静息：workStatus == '1'  &&  (inBed||inBed==undefined) && breathRate>0 && heartRate>0
  - 用户活动：workStatus == '1' && (inBed||inBed==undefined) && (breathRate<=0 || heartRate<=0)  

- 信号强度区间：
  - <-90：无信号
  - \>=-90 && <-80：信号强度1
  - \>=-80 && <-70：信号强度2
  - \>=-70 && <-60：信号强度3
  - \>=-60：信号强度4

## 报告列表数据接口

**简要描述：** 

- 获取报告列表

**请求URL：** 
- ` api-shc.megahealth.cn/1.1/functions/getReportList `

**请求方式：**

- GET

**请求参数：** 

| 参数名        | 必选 | 类型   | 说明                      |
| :------------ | :--- | :----- | ------------------------- |
| institutionId         | 是   | string | 机构id                      |
| start         | 否   | number | 报告开始时间(时间戳，秒)  |
| end           | 否   | number | 报告结束时间 (时间戳，秒) |
| sn            | 否   | string | 设备序列号                |
| phone         | 否   | number | 用户手机号                |
| leaveBedTimes | 否   | number | 起夜次数                  |
| skip          | 否   | number | 跳过记录数量              |
| limit         | 否   | number | 限定获取记录数量          |

**Header属性**

| KEY          | VALUE                             |
| ------------ | --------------------------------- |
| Content-Type | application/json                  |
| X-LC-Id      | F9tyT5VsLXLCAqxKvTHqzmvP-gzGzoHsz |
| X-LC-Key     | 17eIyz42rRL1YubtKE5MgLHm          |
| X-LC-Prod    | 0                                 |

 **返回示例**

``` json
{
    "result": [
        {
            "id": "5e4323e7fbf47f0072da75ec",
            "AHI": 22.3,
            "fallAsleep": 1581426540729,
            "getUp": 1581458400729,
            "recordDay": 1581458400729,
            "username": "胡芦娃",
            "phone": "13569888901",
            "leaveBedTimes": 0,
            "createdAt": 1581580892133
        }
    ]
}
```

 **返回参数说明** 

| 参数名        | 类型   | 说明                          |
| :------------ | :----- | ----------------------------- |
| id            | string | 报告ID                        |
| AHI           | number | 呼吸暂停和低通气指数，1位小数 |
| fallAsleep    | number | 入睡时间，（时间戳）          |
| getUp         | number | 起床时间，（时间戳）          |
| recordDay     | number | 报告记录日期，（时间戳）      |
| phone         | number | 用户手机号                    |
| username      | string | 用户名                        |
| leaveBedTimes | number | 离床次数                      |
| createdAt     | number | 报告生成时间，（时间戳）      |

## 报告详情数据接口

**简要描述：** 

- 获取报告列表

**请求URL：** 
- ` api-shc.megahealth.cn/1.1/functions/getReportDetail `

**请求方式：**

- GET

**请求参数：** 

| 参数名        | 必选 | 类型   | 说明                      |
| :------------ | :--- | :----- | ------------------------- |
| id        | 是   | string | 报告id                  |

**Header属性**

| KEY          | VALUE                             |
| ------------ | --------------------------------- |
| Content-Type | application/json                  |
| X-LC-Id      | F9tyT5VsLXLCAqxKvTHqzmvP-gzGzoHsz |
| X-LC-Key     | 17eIyz42rRL1YubtKE5MgLHm          |
| X-LC-Prod    | 0                                 |

 **返回示例**

``` json
{
    "result": {
          "id": "5c4033aa44d904006a36e4a8",
          "AHI": 5,
          "eventCnt": 123,
          "sn": "S01D190700005D",
          "remoteDevice": {
            "deviceSN": "J01A1812000361",
            "modeType": 1,
            "romVersion": "3.1.11",
            "setTimezone": 800,
            "versionNO": "2.4.12377"
           },
          "startSleepTime": 1547703647000,
          "lastInBedTimeMinute": 123,
          "startStatusTimeMinute": 123,
          "fallSleepTimeMinute": 123,
          "endStatusTimeMinute": 123,
          "lastOffBedTimeMinute": 123,
          "extraCheckTimeMinute": 123, 
          "breathList": [[12,32,2131,2132],[]...], 
          "BMPRList": [[12,66],[]...], 
          "sleepData": [0,2,2,2,3,4,6...], 
          "bodyMoveList": [[12.119701,1.3382328,0],[]...], 
          "userInfo": {
              "age": 18,
              "gender": "M",
              "height": 170,
              "weight": 70,
              "name": "张三",
          },
          "ringData": {
              "AHI":  0,
              "BEMeanlen":    0,
              "BEMaxlen":     0,
              "BEMaxlentime": 0,
              "BECnt":        0,
              "BETotalTime":  0,
              "BETotalrate":  0,
              "BEOHCnt":      0,
              "BECCnt":       0,
              "BEMCnt":       0,
              "Waketime":     0,
              "REMtime":      0,
              "LightSleeptime":       0,
              "DeepSleeptime":        0,
              "Wakerate":     0,
              "REMrate":      0,
              "LightSleeprate":       0,
              "DeepSleeprate":        0,
              "duration":     0,
              "startpos":     0,
              "endpos":       0,
              "handonTotalTime":      0,
              "timeStart":    0,
              "Spo2Avg":      0,
              "Spo2Min":      0,
              "maxSpo2DownTime":      0,
              "prAvg":        0,
              "prMax":        0,
              "prMin":        0,
              "diffThdLge3Cnts":      0,
              "diffThdLge3Pr":        0,
              "spo2Less95Time":       0,
              "spo2Less90Time":       0,
              "spo2Less85Time":       0,
              "spo2Less80Time":       0,
              "spo2Less70Time":       0,
              "spo2Less60Time":       0,
              "spo2Less95TimePercent":        0,
              "spo2Less90TimePercent":        0,
              "spo2Less85TimePercent":        0,
              "spo2Less80TimePercent":        0,
              "spo2Less70TimePercent":        0,
              "spo2Less60TimePercent":        0,
              "handOffArrlen":        0,
              "Spo2Arr":      [],
              "prArr":        [],
              "handOffArr":   [],
              "SAO2EventVect":        []，
              sleepEfficiency：59
          }
      }
}
```

 **返回参数说明** 

| 参数名                         | 类型   | 说明                             |
| :----------------------------- | :----- | -------------------------------- |
| id                             | string | 报告ID                           |
| AHI                            | number | 呼吸暂停和低通气指数，1位小数    |
| eventCnt                       | number | 阻塞及低通气次数                 |
| sn                             | string | 设备号                           |
| remoteDevice.deviceSN          | string | 设备号                           |
| remoteDevice.modeType          | number | 0：成人模式，1：儿童模式         |
| remoteDevice.romVersion        | string | rom版本                          |
| remoteDevice.setTimezone       | number | 时区                             |
| remoteDevice.versionNO         | string | 固件版本                         |
| startSleepTime                 | number | 睡眠相关时间（时间戳），参考备注 |
| lastInBedTimeMinute            | number | 睡眠相关时间（分钟），参考备注   |
| startStatusTimeMinute          | number | 睡眠相关时间（分钟），参考备注   |
| fallSleepTimeMinute            | number | 睡眠相关时间（分钟），参考备注   |
| endStatusTimeMinute            | number | 睡眠相关时间（分钟），参考备注   |
| lastOffBedTimeMinute           | number | 睡眠相关时间（分钟），参考备注   |
| extraCheckTimeMinute           | number | 睡眠相关时间（分钟），参考备注   |
| breathList                     | array  | 呼吸事件数据，参考备注           |
| BMPRList                       | array  | 呼吸率心率数据，参考备注         |
| sleepData                      | array  | 睡眠分期数据，参考备注           |
| bodyMoveList                   | array  | 体动数据，参考备注               |
| userInfo                       | object | 用户信息                         |
| userInfo.name                  | string | 用户姓名                         |
| userInfo.gender                | string | 用户性别，（M：男，F：女）       |
| userInfo.age                   | number | 用户年龄                         |
| userInfo.height                | number | 用户身高                         |
| userInfo.weight                | number | 用户体重                         |
| ringData                       | object | 戒指数据                         |
| ringData.BEMeanlen             | number | 平均暂停和低通气时间(秒)         |
| ringData.BEMaxlen              | number | 最长暂停和低通气时间(秒)         |
| ringData.BEMaxlentime          | number | 最长暂停和低通气时间(秒)发生时间 |
| ringData.BECnt                 | number | 总呼吸事件数(次)                 |
| ringData.BETotalTime           | number | 总呼吸事件时间(分钟)             |
| ringData.BETotalrate           | number | 占总记录时间(%)，2位小数         |
| ringData.BEOHCnt               | number | 阻塞及低通气事件次数             |
| ringData.BECCnt                | number | 中枢性呼吸事件次数               |
| ringData.BEMCnt                | number | 混合性呼吸事件次数               |
| ringData.Waketime              | number | 清醒期时间(分钟)                 |
| ringData.REMtime               | number | 眼动期时间(分钟)                 |
| ringData.LightSleeptime        | number | 浅睡期时间(分钟)                 |
| ringData.DeepSleeptime         | number | 深睡期时间(分钟)                 |
| ringData.Wakerate              | number | 清醒期占比(%)，2位小数           |
| ringData.REMrate               | number | 眼动期占比(%)，2位小数           |
| ringData.LightSleeprate        | number | 浅睡期占比(%)，2位小数           |
| ringData.DeepSleeprate         | number | 深睡期占比(%)，2位小数           |
| ringData.duration              | number | 总时长                           |
| ringData.startpos              | number | 截取开始，未使用字段             |
| ringData.endpos                | number | 截取结束，未使用字段             |
| ringData.handonTotalTime       | number | 佩戴时长                         |
| ringData.timeStart             | number | 开始时间                         |
| ringData.Spo2Avg               | number | 平均血氧                         |
| ringData.Spo2Min               | number | 最低血氧                         |
| ringData.maxSpo2DownTime       | number | 最长氧减时间                     |
| ringData.prAvg                 | number | 平均脉率                         |
| ringData.prMax                 | number | 最大脉率                         |
| ringData.prMin                 | number | 最小脉率                         |
| ringData.diffThdLge3Cnts       | number | 氧减次数                         |
| ringData.diffThdLge3Pr         | number | 氧减指数，1位小数                |
| ringData.spo2Less95Time        | number | 血氧值低于95%的时间              |
| ringData.spo2Less90Time        | number | 血氧值低于90%的时间              |
| ringData.spo2Less85Time        | number | 血氧值低于85%的时间              |
| ringData.spo2Less80Time        | number | 血氧值低于80%的时间              |
| ringData.spo2Less70Time        | number | 血氧值低于70%的时间              |
| ringData.spo2Less60Time        | number | 血氧值低于60%的时间              |
| ringData.spo2Less95TimePercent | number | 血氧值低于95%的比例，2位小数     |
| ringData.spo2Less90TimePercent | number | 血氧值低于90%的比例，2位小数     |
| ringData.spo2Less85TimePercent | number | 血氧值低于85%的比例，2位小数     |
| ringData.spo2Less80TimePercent | number | 血氧值低于80%的比例，2位小数     |
| ringData.spo2Less70TimePercent | number | 血氧值低于70%的比例，2位小数     |
| ringData.spo2Less60TimePercent | number | 血氧值低于60%的比例，2位小数     |
| ringData.handOffArrlen         | number | 离手时长                         |
| ringData.Spo2Arr               | array  | 血氧数据                         |
| ringData.prArr                 | array  | 脉率数据                         |
| ringData.handOffArr            | array  | 离手数据                         |
| ringData.SAO2EventVect         | number | 未使用字段                       |
| ringData.sleepEfficiency       | number | 睡眠效率(%),1位小数              |

 **监测各阶段起止时间定义**

| 实际开启时间        | 初次到床时间            | 睡眠分期开始时间          | 入睡时间                | 睡眠分期结束时间        | 最后在床时间             | 实际结束时间             |
| ------------------- | ----------------------- | ------------------------- | ----------------------- | ----------------------- | ------------------------ | ------------------------ |
| startSleepTime(sst) | sst+lastInBedTimeMinute | sst+startStatusTimeMinute | sst+fallSleepTimeMinute | sst+endStatusTimeMinute | sst+lastOffBedTimeMinute | sst+extraCheckTimeMinute |

- 入睡时间：(fallSleepTimeMinute == -1) ? 实际开启时间 : 入睡时间
- 起床时间：(lastOffBedTimeMinute == -1) ? 实际结束时间 : 最后在床时间
- 入睡时长：入睡时间 - 分期开始
- 睡眠时长：起床 - 入睡
- 分期时长：分期结束 - 分期开始

* * *

**睡眠分期数据**

- sleepData：睡眠分期数组
    - value：0，清醒期
    - value：2，眼动期
    - value：3，浅睡期
    - value：4，深睡期
    - value：6，离床
- 开始时间：睡眠分期开始时间
- 间隔：1分钟

* * *

**体动占比/体动幅度**

- bodyMoveList：体动数据
    - bodyMoveList [i] [0]：体动时长，单位：秒（s）
    - bodyMoveList [i] [1]：体动幅度（1-3）
    - bodyMoveList [i] [2]：离床
- 开始时间：设备实际开启时间
- 间隔：1分钟

* * *

**呼吸率心率趋势**

- BMPRList：呼吸率心率数据
    - BMPRList [i] [0]：呼吸率
    - BMPRList [i] [1]：心率
- 开始时间：BMPRListInfo.startTime
- 间隔：BMPRListInfo.interval

* * *

**血氧趋势**
- spoArr：血氧数组
- 开始时间：timeStart
- 数据间隔：1秒

* * *

**ringData对象解析方法**

```javascript
var encodeRingData = ringData;
var buf = window.atob(encodeRingData);
var decodeRingData = JSON.parse(pako.inflate(buf, { to: 'string' }));
```
window.atob() 方法的作用是对Base64加密字符进行解码
pako.inflate() 方法需要引入外部依赖pako.js

* * *

**呼吸事件数据**

- breathList：呼吸事件二维数组
  - breathList [i] [0]：呼吸事件发生时间，相对于睡眠分期开始时间的秒偏移，单位：秒（s）
  - breathList [i] [1]：呼吸事件持续时长，单位：秒（s）
  - breathList [i] [2]：采样开始帧
  - breathList [i] [3]：采样结束帧
  - breathList [i] [4]：呼吸事件类型（T0:混合型,T1:中枢性,T2:阻塞性,T3:低通气）
- 开始时间：睡眠分期开始时间
- 间隔：不定

**呼吸事件计算方法**

1. **BEMeanlen** 

   平均暂停和低通气时间(秒)

   sum(breathList [i] [1]) / breathList.length

2. **BEMaxlen** 

   最长暂停和低通气时间(秒)

   max(breathList [i] [1])

3. **BEMaxlentime**

   最长暂停和低通气事件发生时间点

   max(breathList [i] [0])

4. **BEOHCnt**

   阻塞及低通气事件次数

   sum(T2+T3)

5. **BECCnt**

   中枢性呼吸事件次数

   sum(T1)

6. **BEMCnt**

   混合性呼吸事件次数

   sum(T0)

7. **BECnt**

   总呼吸事件次数

   breathList.length = eventCnt

8. **BETotalTime**

   总呼吸事件时间(分钟)

   sum(breathList [i] [1])/60

9. **BETotalrate**

   占总记录时间(%)

   sum(breathList [i] [1])/60/totalSleepMinutes

由于之前并没有上传报告的呼吸事件类型TYPE字段，呼吸事件类型无法判断

**无血氧时呼吸事件计算方法**

```javascript
/*计算呼吸事件
*@method getBreathEvent
*@param {array} array breathList数组,0:发声时间,1:持续时长,2:开始采样帧,3:结束采样帧,4:呼吸事件类型
*@param {number} totalSleepMinutes 总睡眠时长，分钟
*@return {object} 包含9个呼吸事件相关数据的对象
*/
function getBreathEvent(array,totalSleepMinutes) {
    var hasBreathType = (array.length>0&&array[0].length > 4)?true:false;
    var max = 0;
    var maxDuration = '';
    var total = 0;
    //t0:混合性 t1：中枢性 t2：阻塞性 t3：低通气
    var breathTypeEnt = {
        t0: 0,
        t1: 0,
        t2: 0,
        t3: 0
    };
    if (array.length !== 0) {
        for (var i = 0; i < array.length; i++) {
            var thisValue = array[i][1];
            if(max<thisValue) {
                max = thisValue;
                maxDuration = array[i][0];
            }
            total += thisValue;
            if(hasBreathType) {
                switch (array[i][4]) {
                    case 0:
                        breathTypeEnt.t0++;
                        break;
                    case 1:
                        breathTypeEnt.t1++;
                        break;
                    case 2:
                        breathTypeEnt.t2++;
                        break;
                    case 3:
                        breathTypeEnt.t3++;
                        break;
                }
            }
        }
    }

    return {
        BEMeanlen: (total/array.length).toFixed(0),
        BEMaxlen: max,
        BEMaxlentime: maxDuration,
        BEOHCnt: breathTypeEnt.t2 + breathTypeEnt.t3,
        BECCnt: breathTypeEnt.t1,
        BEMCnt: breathTypeEnt.t0,
        BECnt: array.length,
        BETotalTime: (total/60).toFixed(0),
        BETotalrate: (total/60/totalSleepMinutes).toFixed(1),
    };
}
```

## 设定监测时段接口

**简要描述：** 

- 设定设备监测时段

**请求URL：** 
- ` api-shc.megahealth.cn/1.1/functions/setMonitorPeriod `

**请求方式：**

- GET

**请求参数：** 

| 参数名 | 必选 | 类型   | 说明                            |
| :----- | :--- | :----- | ------------------------------- |
| start  | 是   | string | 监测时段开始时间点，格式：22:00 |
| end    | 是   | number | 监测时段结束时间点，格式：06:00 |
| sn     | 是   | string | 设备序列号                      |

**Header属性**

| KEY          | VALUE                             |
| ------------ | --------------------------------- |
| Content-Type | application/json                  |
| X-LC-Id      | F9tyT5VsLXLCAqxKvTHqzmvP-gzGzoHsz |
| X-LC-Key     | 17eIyz42rRL1YubtKE5MgLHm          |
| X-LC-Prod    | 0                                 |

 **返回示例**

``` json
{
    "result": "success"
}
```

## 设备升级开关接口

**简要描述：** 

- 打开或关闭设备升级开关

**请求URL：** 
- ` api-shc.megahealth.cn/1.1/functions/openAutoUpgradeDevice `

**请求方式：**

- GET

**请求参数：** 

| 参数名 | 必选 | 类型   | 说明                     |
| :----- | :--- | :----- | ------------------------ |
| sn     | 是   | string | 设备序列号               |
| flag   | 是   | number | 开启命令：1，关闭命令：0 |

**Header属性**

| KEY          | VALUE                             |
| ------------ | --------------------------------- |
| Content-Type | application/json                  |
| X-LC-Id      | F9tyT5VsLXLCAqxKvTHqzmvP-gzGzoHsz |
| X-LC-Key     | 17eIyz42rRL1YubtKE5MgLHm          |
| X-LC-Prod    | 0                                 |

 **返回示例**

``` json
{
    "result": "success"
}
```
## 戒指绑定开关接口

**简要描述：** 

- 打开或关闭戒指绑定开关

**请求URL：** 
- ` api-shc.megahealth.cn/1.1/functions/openAutoBindRing `

**请求方式：**

- GET

**请求参数：** 

| 参数名 | 必选 | 类型   | 说明                     |
| :----- | :--- | :----- | ------------------------ |
| sn     | 是   | string | 设备序列号               |
| flag   | 是   | number | 开启命令：1，关闭命令：0 |

**Header属性**

| KEY          | VALUE                             |
| ------------ | --------------------------------- |
| Content-Type | application/json                  |
| X-LC-Id      | F9tyT5VsLXLCAqxKvTHqzmvP-gzGzoHsz |
| X-LC-Key     | 17eIyz42rRL1YubtKE5MgLHm          |
| X-LC-Prod    | 0                                 |

 **返回示例**

``` json
{
    "result": "success"
}
```



## 设定工作模式接口

**简要描述：**

- 设定工作模式（儿童/成人）

**请求URL：**

- `api-shc.megahealth.cn/1.1/functions/setModeType`

**请求方式：**

- GET

**请求参数：**

| 参数名 | 必选 | 类型   | 说明             |
| ------ | ---- | ------ | ---------------- |
| sn     | 是   | string | 设备序列号       |
| mode   | 是   | number | 0：成人，1：儿童 |

**Header属性**

| KEY          | VALUE                             |
| ------------ | --------------------------------- |
| Content-Type | application/json                  |
| X-LC-Id      | F9tyT5VsLXLCAqxKvTHqzmvP-gzGzoHsz |
| X-LC-Key     | 17eIyz42rRL1YubtKE5MgLHm          |
| X-LC-Prod    | 1                                 |

**返回示例**

```json
{
    "result": "success"
}
```

## **设备实时推送数据**

**简要描述：**

- 设备实时推送数据字段说明

**推送数据示例**

```json
{
    "sn": "J01A18120001C4",
    "workStatus": "1",
    "monitorStatus": "0",
    "inBed": true,
    "breathRate": 24,
    "heartRate": 79,
    "bloodOxygen": 0,
    "battery": 0,
    "ringsn": "",
    "swVersion": "",
    "monitor": 0,
    "powerStatus": 0,
    "connectStatus": 0,
    "tempetature": 28.783,
    "bootTime": 1713951882000,
    "wifiRssi": -51,
    "networkType": 1,
    "frameArea": 2,
    "period": "23:00-09:50",
     "simSerialNumber": "898604E4192390239425",
    "versionNO": "2.4.12377",
    "updatedAt": 1714029615343,
    "ringStatus": -1,
    "EC6Version": "1.0.12487" //只有M11B开头的设备推送
}
```

**返回参数说明**

| 参数名 | 类型 | 说明 |
| --- | --- | --- |
| sn | string | 睡眠仪设备序列号 |
| workStatus | number | 睡眠仪设备工作状态（0：未工作，1：工作中，2：未工作） |
| monitorStatus | number | 睡眠仪监测状态：（0：未监测,1：监测中） |
| inBed | boolean | 是否离床，（true：在床，false：离床） |
| breathRate | number | 呼吸率 |
| heartRate | number | 心率 |
| bloodOxygen | number | 血氧饱和度 |
| battery | number | 指环电量 |
| ringsn | string | 指环sn |
| swVersion | string | 指环固件版本 |
| monitor | number | 指环监测状态：（0：未监测,1：监测中） |
| powerStatus | number | 0: 正常工作；1: 正在充电；2: 充满，可工作；3: 低电，设备只保留蓝牙，其他模块关闭 |
| connectStatus | number | 指环连接状态，0：未连接  1连接中   2：已连接 |
| tempetature | number | 温度，3位小数 |
| bootTime | number | 设备启动时间，用以矫正温度值 |
| wifiRssi | number | wifi信号 |
| mobileRssi | number | 移动信号 |
| networkType | number | 网络类型（0：移动信号，1：wifi信号） |
| frameArea | number | 雷达监测距离（默认值：2，单位米） |
| simSerialNumber | number | sim卡号 |
| period | string | 定时监测时间段（如:"23:00-09:50"） |
| versionNO | string | 监护仪固件版本号 |
| updatedAt | number | 设备更新时间 |
| ringStatus | number | 指环工作状态，默认：-1监测中：0待收取数据：1已收取数据:2 |
| EC6Version | string | EC6版本号(只有M11B开头的设备推送) |

**备注**

- 温度矫正方法：bootTime为设备启动时间，设diff为设备已启动分钟数
```javascript
if (diff <= 30) {
    temperature = temperature - diff * 0.2;
} else {
    temperature = temperature - 6;
}
```

- 信号强度区间：
   - <-90：无信号
   - >=-90 && <-80：信号强度1
   - >=-80 && <-70：信号强度2
   - >=-70 && <-60：信号强度3
   - >=-60：信号强度4

- 置信度

呼吸心跳有效信号能量在回波总能量中占比，取值范围[0~1,-1,-2,-3,-4,-5,-6) 
0：小波变换后，主频率分量不是有效频率分量 （多见于无人）
-1：（NULL）
-2：前后一分钟内波形相关系数过高，可能是石英钟干扰，此时呼吸率心率没有清零
-3：最高频率分量大于等于1Hz（多见于无人情况下闹钟干扰）
-4：0.12Hz以下频段能量最高值及其倍频异常高（多见于低频规律干扰）
-5：大幅度干扰（多见于摇头风扇和一直体动）
-6：0.05Hz-0.1Hz频段能量大于呼吸0.13-1Hz频段能量（多见于台式风扇外页旋转和部分石英钟干扰）

推送机构：

道奇浙江医疗体检（S01D设备所在机构）：5df893a08a84ab007467f75e（机构id）

杭州道奇（M11B设备所在机构）:65a11352a5a5f27381c3c7b5(机构id)

推送接口：

- https://api.bajiesleep.com/bjWeb/device/realTimeDataSave

## 报告推送数据

**简要描述：** 

- 报告推送数据字段说明

 **返回示例**

``` json
{
    "result": {
        "id": "6642a87c0b74d82a76981931",
        "AHI": 4.13,
        "eventCnt": 173,
        "sn": "S01D190700005D",
        "remoteDevice": {
            "deviceSN": "J01A1812000361",
            "modeType": 1,
            "romVersion": "3.1.11",
            "setTimezone": 800,
            "versionNO": "2.4.12377"
        },
        "startSleepTime": 1715610600567,
        "lastInBedTimeMinute": 0,
        "startStatusTimeMinute": 13,
        "fallSleepTimeMinute": 28,
        "endStatusTimeMinute": 570,
        "lastOffBedTimeMinute": 570,
        "extraCheckTimeMinute": 570,
        "endSleepTimeMinute": 566,
        "breathList": [[1715612493,8,23547,23723,2],[1715612774,36,29287,30042,2]],
        "BMPRList": [[12,75],[22,70]],
        "BMPRListInfo": {"interval": 60,"startTime": 1715610122},
        "sleepData": [0,0,3,3],
        "bodyMoveList": [[31.30016,0.0025077758,0],[15.90072,0.0014835249,0]],
        "userInfo": {
            "age": 21,
            "gender": "M",
            "height": "175",
            "weight": "75",
            "name": "dq003-1"
        },
        "ringData": {
            "AHI": 4.13,
            "AI": 3.95,
            "HI": 0.18,
            "BEMeanlen": 18,
            "BEMaxlen": 65,
            "BEMaxlentime": 1715639925,
            "BECnt": 23,
            "BETotalTime": 7,
            "BETotalrate": 1.3,
            "BEOHCnt": 23,
            "BECCnt": 0,
            "BEMCnt": 0,
            "BEOCnt": 22,
            "BEHCnt": 1,
            "Waketime": 204,
            "REMtime": 29,
            "LightSleeptime": 175,
            "DeepSleeptime": 130,
            "Wakerate": "",
            "REMrate": 8.68,
            "LightSleeprate": 52.4,
            "DeepSleeprate": 38.92,
            "duration": 34193,
            "startpos": 0,
            "endpos": 30909,
            "handonTotalTime": 16213,
            "timeStart": 1715610602,
            "Spo2Avg": 95.52,
            "Spo2Min": 90.08,
            "maxSpo2DownTime": 37,
            "prAvg": 86,
            "prMax": 107,
            "prMin": 68,
            "diffThdLge3Cnts": 4,
            "diffThdLge3Pr": 1.36,
            "spo2Less95Time": 5441,
            "spo2Less90Time": 0,
            "spo2Less85Time": 0,
            "spo2Less80Time": 0,
            "spo2Less70Time": 0,
            "spo2Less60Time": 0,
            "spo2Less95TimePercent": 51.53,
            "spo2Less90TimePercent": 0,
            "spo2Less85TimePercent": 0,
            "spo2Less80TimePercent": 0,
            "spo2Less70TimePercent": 0,
            "spo2Less60TimePercent": 0,
            "lastInBedTimeMinute": 0,
            "startStatusTimeMinute": 13,
            "fallSleepTimeMinute": 28,
            "endSleepTimeMinute": 566,
            "endStatusTimeMinute": 570,
            "lastOffBedTimeMinute": 570,
            "extraCheckTimeMinute": 570,
            "handOffArrlen": 2,
            "Spo2Arr": [98.05,98.03,98.01],
            "prArr": [68,68,81],
            "handOffArr": [11835,26531],
            "SAO2EventVect": [[10559,37],[10794,27]],
            "BreathEventVect": [[1715612493,8,23547,23723,2],[1715612774,36,29287,30042,2]],
            "Stages": [0,0,0],
            "sleepEfficiency": 59
        }
    }
}
```

 **返回参数说明** 

| 参数名                         | 类型   | 说明                                                         |
| :----------------------------- | :----- | ------------------------------------------------------------ |
| id                             | string | 报告ID                                                       |
| AHI                            | number | 呼吸暂停和低通气指数，1位小数                                |
| eventCnt                       | number | 阻塞及低通气次数                                             |
| sn                             | string | 设备号                                                       |
| remoteDevice.deviceSN          | string | 设备号                                                       |
| remoteDevice.modeType          | number | 0：成人模式，1：儿童模式                                     |
| remoteDevice.romVersion        | string | rom版本                                                      |
| remoteDevice.setTimezone       | number | 时区                                                         |
| remoteDevice.versionNO         | string | 固件版本                                                     |
| startSleepTime                 | number | 睡眠相关时间（时间戳），参考备注                             |
| lastInBedTimeMinute            | number | 睡眠相关时间（分钟），参考备注                               |
| startStatusTimeMinute          | number | 睡眠相关时间（分钟），参考备注                               |
| fallSleepTimeMinute            | number | 睡眠相关时间（分钟），参考备注                               |
| endStatusTimeMinute            | number | 睡眠相关时间（分钟），参考备注                               |
| lastOffBedTimeMinute           | number | 睡眠相关时间（分钟），参考备注                               |
| extraCheckTimeMinute           | number | 睡眠相关时间（分钟），参考备注                               |
| endSleepTimeMinute             | number | 睡眠相关时间（分钟），参考备注                               |
| breathList                     | array  | 呼吸事件数据，参考备注                                       |
| BMPRList                       | array  | 呼吸率心率数据，参考备注                                     |
| BMPRListInfo                   | object | 呼吸率心率数据，参考备注                                     |
| sleepData                      | array  | 睡眠分期数据，参考备注                                       |
| bodyMoveList                   | array  | 体动数据，参考备注                                           |
| userInfo                       | object | 用户信息                                                     |
| userInfo.name                  | string | 用户姓名                                                     |
| userInfo.gender                | string | 用户性别，（M：男，F：女）                                   |
| userInfo.age                   | number | 用户年龄                                                     |
| userInfo.height                | number | 用户身高                                                     |
| userInfo.weight                | number | 用户体重                                                     |
| ringData                       | object | 戒指数据                                                     |
| ringData.AHI                   | number | 呼吸暂停和低通气指数，1位小数                                |
| ringData.AI                    | number | AI指数                                                       |
| ringData.AI                    | number | HI指数                                                       |
| ringData.BEMeanlen             | number | 平均暂停和低通气时间(秒)                                     |
| ringData.BEMaxlen              | number | 最长暂停和低通气时间(秒)                                     |
| ringData.BEMaxlentime          | number | 最长暂停和低通气时间(秒)发生时间                             |
| ringData.BECnt                 | number | 总呼吸事件数(次)                                             |
| ringData.BETotalTime           | number | 总呼吸事件时间(分钟)                                         |
| ringData.BETotalrate           | number | 占总记录时间(%)，2位小数                                     |
| ringData.BEOHCnt               | number | 阻塞及低通气事件次数                                         |
| ringData.BECCnt                | number | 中枢性呼吸事件次数                                           |
| ringData.BEMCnt                | number | 混合性呼吸事件次数                                           |
| ringData.Waketime              | number | 清醒期时间(分钟)                                             |
| ringData.REMtime               | number | 眼动期时间(分钟)                                             |
| ringData.LightSleeptime        | number | 浅睡期时间(分钟)                                             |
| ringData.DeepSleeptime         | number | 深睡期时间(分钟)                                             |
| ringData.Wakerate              | number | 清醒期占比(%)                                                |
| ringData.REMrate               | number | 眼动期占比(%)，2位小数                                       |
| ringData.LightSleeprate        | number | 浅睡期占比(%)，2位小数                                       |
| ringData.DeepSleeprate         | number | 深睡期占比(%)，2位小数                                       |
| ringData.duration              | number | 总时长                                                       |
| ringData.startpos              | number | 截取开始，未使用字段                                         |
| ringData.endpos                | number | 截取结束，未使用字段                                         |
| ringData.lastInBedTimeMinute   | number | 睡眠相关时间（分钟），参考备注                               |
| ringData.startStatusTimeMinute | number | 睡眠相关时间（分钟），参考备注                               |
| ringData.fallSleepTimeMinute   | number | 睡眠相关时间（分钟），参考备注                               |
| ringData.endStatusTimeMinute   | number | 睡眠相关时间（分钟），参考备注                               |
| ringData.endSleepTimeMinute    | number | 睡眠相关时间（分钟），参考备注                               |
| ringData.lastOffBedTimeMinute  | number | 睡眠相关时间（分钟），参考备注                               |
| ringData.extraCheckTimeMinute  | number | 睡眠相关时间（分钟），参考备注                               |
| ringData.handonTotalTime       | number | 佩戴时长                                                     |
| ringData.timeStart             | number | 开始时间                                                     |
| ringData.Spo2Avg               | number | 平均血氧                                                     |
| ringData.Spo2Min               | number | 最低血氧                                                     |
| ringData.maxSpo2DownTime       | number | 最长氧减时间                                                 |
| ringData.prAvg                 | number | 平均脉率                                                     |
| ringData.prMax                 | number | 最大脉率                                                     |
| ringData.prMin                 | number | 最小脉率                                                     |
| ringData.diffThdLge3Cnts       | number | 氧减次数                                                     |
| ringData.diffThdLge3Pr         | number | 氧减指数，1位小数                                            |
| ringData.spo2Less95Time        | number | 血氧值低于95%的时间                                          |
| ringData.spo2Less90Time        | number | 血氧值低于90%的时间                                          |
| ringData.spo2Less85Time        | number | 血氧值低于85%的时间                                          |
| ringData.spo2Less80Time        | number | 血氧值低于80%的时间                                          |
| ringData.spo2Less70Time        | number | 血氧值低于70%的时间                                          |
| ringData.spo2Less60Time        | number | 血氧值低于60%的时间                                          |
| ringData.spo2Less95TimePercent | number | 血氧值低于95%的比例，2位小数                                 |
| ringData.spo2Less90TimePercent | number | 血氧值低于90%的比例，2位小数                                 |
| ringData.spo2Less85TimePercent | number | 血氧值低于85%的比例，2位小数                                 |
| ringData.spo2Less80TimePercent | number | 血氧值低于80%的比例，2位小数                                 |
| ringData.spo2Less70TimePercent | number | 血氧值低于70%的比例，2位小数                                 |
| ringData.spo2Less60TimePercent | number | 血氧值低于60%的比例，2位小数                                 |
| ringData.handOffArrlen         | number | 离手时长                                                     |
| ringData.Spo2Arr               | array  | 血氧数据                                                     |
| ringData.prArr                 | array  | 脉率数据                                                     |
| ringData.handOffArr            | array  | 离手数据                                                     |
| ringData.SAO2EventVect         | number | 未使用字段                                                   |
| ringData.BreathEventVect       | array  | 有血氧数据时直接使用血氧数据中解析<br />出来的呼吸事件数组BreathEventVect，<br />[0:发生时间点,1:持续时长,2:开始采样帧,3:结束采样帧,4:呼吸事件类型] |
| ringData.sleepEfficiency       | number | 睡眠效率(%),1位小数                                          |

 **监测各阶段起止时间定义**

| 实际开启时间        | 初次到床时间            | 睡眠分期开始时间          | 入睡时间                | 睡眠分期结束时间        | 最后一次清醒开始时间   | 最后在床时间             | 实际结束时间             |
| ------------------- | ----------------------- | ------------------------- | ----------------------- | ----------------------- | ---------------------- | ------------------------ | ------------------------ |
| startSleepTime(sst) | sst+lastInBedTimeMinute | sst+startStatusTimeMinute | sst+fallSleepTimeMinute | sst+endStatusTimeMinute | sst+endSleepTimeMinute | sst+lastOffBedTimeMinute | sst+extraCheckTimeMinute |

- 入睡时间：(fallSleepTimeMinute == -1) ? 实际开启时间 : 入睡时间
- 起床时间：(endSleepTimeMinute == -1) ? 实际结束时间 : 最后一次清醒开始时间
- 入睡时长：入睡时间 - 分期开始
- 睡眠时长：起床 - 入睡
- 分期时长：分期结束 - 分期开始（分期时长小于三小时，报告为无效报告）

* * *

**睡眠分期数据**

- sleepData：睡眠分期数组
    - value：0，清醒期
    - value：2，眼动期
    - value：3，浅睡期
    - value：4，深睡期
    - value：6，离床
- 开始时间：睡眠分期开始时间
- 间隔：1分钟

* * *

**体动占比/体动幅度**

- bodyMoveList：体动数据
    - bodyMoveList [i] [0]：体动时长，单位：秒（s）
    - bodyMoveList [i] [1]：体动幅度（1-3）
    - bodyMoveList [i] [2]：离床
- 开始时间：设备实际开启时间
- 间隔：1分钟

* * *

**呼吸率心率趋势**

- BMPRList：呼吸率心率数据
    - BMPRList [i] [0]：呼吸率
    - BMPRList [i] [1]：心率
- 开始时间：BMPRListInfo.startTime
- 间隔：BMPRListInfo.interval

* * *

**血氧趋势**
- spoArr：血氧数组
- 开始时间：timeStart
- 数据间隔：1秒
- 推送过来的数据为算法解析后的原始数据，现在兆观后台页面’**睡眠血氧趋势*‘*图中以及报告中最低血氧、平均血氧显示是整数，若也要显示为整数，可自行取整，取整方法Math.round(x)。

* * *

**ringData对象解析方法**

```javascript
var encodeRingData = ringData;
var buf = window.atob(encodeRingData);
var decodeRingData = JSON.parse(pako.inflate(buf, { to: 'string' }));
```
window.atob() 方法的作用是对Base64加密字符进行解码
pako.inflate() 方法需要引入外部依赖pako.js

* * *

**呼吸事件数据**

- breathList：呼吸事件二维数组
  - breathList [i] [0]：呼吸事件发生时间，相对于睡眠分期开始时间的秒偏移，单位：秒（s）
  - breathList [i] [1]：呼吸事件持续时长，单位：秒（s）
  - breathList [i] [2]：采样开始帧
  - breathList [i] [3]：采样结束帧
  - breathList [i] [4]：呼吸事件类型（T0:混合型,T1:中枢性,T2:阻塞性,T3:低通气）
- 开始时间：睡眠分期开始时间
- 间隔：不定

**呼吸事件计算方法**

1. **BEMeanlen** 

   平均暂停和低通气时间(秒)

   sum(breathList [i] [1]) / breathList.length

2. **BEMaxlen** 

   最长暂停和低通气时间(秒)

   max(breathList [i] [1])

3. **BEMaxlentime**

   最长暂停和低通气事件发生时间点

   max(breathList [i] [0])

4. **BEOHCnt**

   阻塞及低通气事件次数

   sum(T2+T3)

5. **BECCnt**

   中枢性呼吸事件次数

   sum(T1)

6. **BEMCnt**

   混合性呼吸事件次数

   sum(T0)

7. **BECnt**

   总呼吸事件次数

   breathList.length = eventCnt

8. **BETotalTime**

   总呼吸事件时间(分钟)

   sum(breathList [i] [1])/60

9. **BETotalrate**

   占总记录时间(%)

   sum(breathList [i] [1])/60/totalSleepMinutes

由于之前并没有上传报告的呼吸事件类型TYPE字段，呼吸事件类型无法判断

**无血氧时呼吸事件计算方法**

有血氧数据时直接使用血氧数据中解析出来的呼吸事件数组，BreathEventVect

```javascript
/*计算呼吸事件
*@method getBreathEvent
*@param {array} array breathList数组,0:发声时间,1:持续时长,2:开始采样帧,3:结束采样帧,4:呼吸事件类型
*@param {number} totalSleepMinutes 总睡眠时长，分钟
*@return {object} 包含9个呼吸事件相关数据的对象
*/
function getBreathEvent(array,totalSleepMinutes) {
    var hasBreathType = (array.length>0&&array[0].length > 4)?true:false;
    var max = 0;
    var maxDuration = '';
    var total = 0;
    //t0:混合性 t1：中枢性 t2：阻塞性 t3：低通气
    var breathTypeEnt = {
        t0: 0,
        t1: 0,
        t2: 0,
        t3: 0
    };
    if (array.length !== 0) {
        for (var i = 0; i < array.length; i++) {
            var thisValue = array[i][1];
            if(max<thisValue) {
                max = thisValue;
                maxDuration = array[i][0];
            }
            total += thisValue;
            if(hasBreathType) {
                switch (array[i][4]) {
                    case 0:
                        breathTypeEnt.t0++;
                        break;
                    case 1:
                        breathTypeEnt.t1++;
                        break;
                    case 2:
                        breathTypeEnt.t2++;
                        break;
                    case 3:
                        breathTypeEnt.t3++;
                        break;
                }
            }
        }
    }

    return {
        BEMeanlen: (total/array.length).toFixed(0),
        BEMaxlen: max,
        BEMaxlentime: maxDuration,
        BEOHCnt: breathTypeEnt.t2 + breathTypeEnt.t3,
        BECCnt: breathTypeEnt.t1,
        BEMCnt: breathTypeEnt.t0,
        BECnt: array.length,
        BETotalTime: (total/60).toFixed(0),
        BETotalrate: (total/60/totalSleepMinutes).toFixed(1),
    };
}
```

****

**专家评估建议部分**

成人判断标准：

0<=  AHI < 5 		 正常

5<=  AHI <15		 轻度  	

15<= AHI <30	    中度

30<= AHI			    重度

儿童判断标准：

0<= AHI <1 		正常

1<= AHI <5		 轻度

5<= AHI <10      中度			

10<= AHI			重度

**1，正常**

**呼吸质量： 正常**

**睡眠分期分析：**您的总睡眠时间为6小时0分，睡眠效率(TST/TIB)为86.1%， 其中深睡期占比48.62%，浅睡期占比29.44%，快速眼动期占比21.94%。

**睡眠呼吸综述：**您的AHI指数为4.2， 睡眠呼吸状态正常。 夜间平均血氧饱和度为98%， 最低血氧饱和度为94% 。

**建议：**

1.保持良好的生活习惯；

2.适当运动，增强体质；

3.定期进行睡眠监测；



**2，轻度**

**呼吸质量： 轻度**

**睡眠分期分析：**您的总睡眠时间为5小时31分，睡眠效率(TST/TIB)为97.1%， 其中深睡期占比45.92%，浅睡期占比32.93%，快速眼动期占比21.15%。

**睡眠呼吸综述：**您的AHI指数为5.8， 符合 **【轻度】** 睡眠呼吸暂停低通气综合征的诊断。 夜间平均血氧饱和度为98%， 最低血氧饱和度为91% 。 

**建议：**

1.饮食宜清淡，戒烟、戒酒；适当运动，增强体质，控制BMI（身体质量指数）在18.5-24；使用右侧卧位睡姿入眠；慎用或停用镇静、安眠药物；

2.最好连续睡眠监测，留意睡眠呼吸状态的变化趋势；

3.轻度患者，但症状明显（如白天嗜睡、认知障碍、抑郁等），合并或并发心脑血管疾病和糖尿病等，应压力滴定后，进行无创气道正压通气治疗。



**3，中度**

**呼吸质量： 中度**

**睡眠分期分析：**您的总睡眠时间为1小时51分，睡眠效率(TST/TIB)为91.7%， 其中深睡期占比44.14%，浅睡期占比47.75%，快速眼动期占比8.11%。

**睡眠呼吸综述：**您的OAHI指数为7.0， 符合 **【中度】** 睡眠呼吸暂停低通气综合征的诊断。 夜间平均血氧饱和度为95%， 最低血氧饱和度为86% 。

**建议：**

1.饮食宜清淡，戒烟、戒酒；适当运动，增强体质，控制BMI（身体质量指数）在18.5-24；使用右侧卧位睡姿入眠；慎用或停用镇静、安眠药物；

2.耳鼻喉科就诊，了解有无口或咽喉部位解剖学异常，必要时进行鼻咽部CT/MRI了解有无手术指症状；

3.排除上呼吸道病变后，转睡眠呼吸专科就诊，经压力滴定测试后，无论是否手术均建议夜间无创正压通气治疗；

4.最好连续的睡眠监测，治疗3-6月后进行门诊复诊；



**4，重度**

**呼吸质量： 重度**

**睡眠分期分析：**您的总睡眠时间为8小时47分钟，睡眠效率(TST/TIB)为76.5%， 其中深睡期占比31.12%，浅睡期占比37.19%，快速眼动期占比8.16%。

**睡眠呼吸综述：**您的AHI指数为40.4， 符合 **【重度】** 睡眠呼吸暂停低通气综合征的诊断。 夜间平均血氧饱和度为92%， 最低血氧饱和度为77% 。

**建议：**

1.结合临床完善相关检查；

2.耳鼻喉科就诊，了解有无口部咽喉部位解剖学异常，必要时进行鼻咽部CT/MRI了解有无手术指症状；

3.排除上呼吸道病变后，转睡眠呼吸专科就诊，经压力滴定测试后，无论是否手术均建议夜间无创正压通气治疗；

4.饮食宜清淡，戒烟、戒酒；适当运动，增强体质，控制BMI（身体质量指数）在18.5-24；使用右侧卧位睡姿入眠；慎用或停用镇静、安眠药物；

5.最好连续的睡眠监测，治疗3-6月后进行门诊复诊；



**呼吸波数据接口**

**简要描述：**

- 呼吸波数据接口

**请求URL：**

- `https://webapi.megahealth.cn/webApi/breathWave`

**请求方式：**

- GET

**参数：**

| 参数名 | 必选 | 类型   | 说明   |
| ------ | ---- | ------ | ------ |
| id     | 是   | string | 报告ID |

**返回示例**

```json
//有呼吸波数据时返回：
[
    [
        [
            1719936990  //开始时间
        ],
        [-3.27,-4.13,-5.02,...]//呼吸波数据
    ],//第一分钟的的呼吸波数据
    [
        [
            1719937050
        ],
        [ -0.07,-0.07,-0.06,-0.05,...]
    ]，////第二分钟的的呼吸波数据
    ...
  ]
  
//没有呼吸波数据时返回
{
    "code": 0,
    "data": "no wave file"
}
```

**呼吸波数据画图处理方式**

```javascript
	let waveChartData = [];
    for (let i = 0; i < waveData.length; i++) {
      const minuteWave = waveData[i];
      const minuteWaveStart = minuteWave[0]*1000;
      const minuteWaveLength = minuteWave[1].length;
      const minuteWaveData = minuteWave[1];
      const minuteWaveInterval = Math.round((60000/minuteWaveLength)*100)/100;
      for (let j = 0; j < minuteWaveLength; j+=10) {
        const d = minuteWaveData[j];
        const t = minuteWaveStart + minuteWaveInterval*j;
        waveChartData.push([t, d])
      }
    }
```



