# 统一UID需求分析

## 背景

兆观智能硬件账号打通，实现同一用户在多个设备上都能有效收取数据，解决监测数据丢失和错误归属问题。

## 方案

**规定MHN中User表objectId为用户UID。**

目前主要实现SHC应用和MHN的戒指数据互通。

SHC下养老个人用户使用patients表进行登录，存在隐患，后续逐步改为MHN的_User表登录。目前SHC下已使用MHN的 User表登录的是 MegaCare（英文版盒子固件的球形监护仪）。

MHN下兆观健康使用自身应用User登录，因此登录用户的objectId即为UID。兆观健康为支持此特性，需在报告上传时将获取到的UID设置到收取报告RingSport的userId字段上。

## 场景

### App抢App

张三抢了李四的（正在监测中或刚监测结束未收取数据）戒指进行重新绑定，发现戒指内已有一份数据，此时App需要帮李四收取这份数据并上传。戒指里李四的UID对应报告上传后RingSport表的userId。李四查看报告列表时即可看到这份被张三上传的数据。

### App抢监护仪

张三使用App抢了李四绑定在监护仪上的戒指，且此前监护仪上的戒指正在监测中或刚监测结束未收取数据。开启新的监测前，张三先收取了这份报告并上传。监护仪结束监测上传报告时发现戒指已断开连接无法收取报告，此时去MHN的RingSport查看是否有张三UID的符合时间节点的戒指数据，有则将数据拉取到SHC中Reports表的RingData字段上。同步完成。

### 监护仪抢App

张三使用监护仪抢了李四绑定在App上的戒指（正在监测中或刚监测结束未收取数据）。张三需先将数据收取，由于此时不知道数据来自App还是监护仪，因此收取来的base64数据会被转换成bin文件上传到SHC的File下。App在结束监测后发现没有数据，则去SHC的File中查询一下，bin文件的具体存取和查询方法需确定。如果被抢走的是监护仪的戒指数据，方法类似。

### 监护仪抢监护仪

同上。